<head>
	<script src="./functions.js"></script>
	<link href="products-style.css" rel="stylesheet" />
</head>

<h2>JavaScript input filter showcase</h2>
<p>
	Supports Copy+Paste, Drag+Drop, keyboard shortcuts, context menu operations,
	non-typeable keys, the caret position, different keyboard layouts, and
	<a href="https://caniuse.com/#feat=input-event" target="_blank"
		>all browsers since IE 9</a
	>.
</p>
<p>
	There is also a
	<a href="https://jsfiddle.net/emkey08/tvx5e7q3" target="_blank"
		>jQuery version</a
	>
	of this.
</p>
<table>
	<tr>
		<td>CUSTOMQUANTITY</td>
		<td><input id="custquantTextBox" /></td>
	</tr>
</table>

<script>
	// HEAVILY MODIFIED, inspired by emkey08's response (https://stackoverflow.com/questions/469357/html-text-input-allow-only-numeric-input)
	function setInputFilter(textbox, inputFilter) {
		[
			"input",
			"keydown",
			"keyup",
			"mousedown",
			"mouseup",
			"select",
			"contextmenu",
			"drop",
			"focusout",
		].forEach(function (event) {
			textbox.addEventListener(event, function (e) {
				if (inputFilter(this.value)) {
					// Accepted value
					if (
						[
							"input",
							"keydown",
							"keyup",
							"mousedown",
							"mouseup",
							"select",
							"contextmenu",
							"drop",
							"focusout",
						].indexOf(e.type) >= 0
					) {
						this.classList.remove("input-error");
						this.setCustomValidity("");
					}
					this.oldValue = this.value;
					this.oldSelectionStart = this.selectionStart;
					this.oldSelectionEnd = this.selectionEnd;
				} else if (this.hasOwnProperty("oldValue")) {
					// Rejected value
					this.classList.add("input-error");
					console.log("What is=" + this.value);
					if (/^[1-9]\d*(\.\d+)?$/.test(this.value) == false) {
						// must be a number
						errMsg = "Not a Number!";
					} else if (/^-?\d*$/.test(this.value) == false) {
						// must be an integer
						errMsg = "Not an Integer!";
					} else if (/^\d*$/.test(this.value) == false) {
						// must be a non negative integer
						errMsg = "Can't be negative!";
					} else {
						errMsg = "Unknown Error";
					}
					console.log("errormessage=" + errMsg);
					this.setCustomValidity(errMsg);
					this.reportValidity();
				} else {
					// Rejected value - nothing to restore
					this.value = "";
				}
			});
		});
	}

	setInputFilter(document.getElementById("custquantTextBox"), function (value) {
		if (/^[1-9]\d*(\.\d+)?$/.test(value) == false) {
			// must be a number
			return /^[1-9]\d*(\.\d+)?$/.test(value);
		} else if (/^-?\d*$/.test(value) == false) {
			// must be an integer
			return /^-?\d*$/.test(value);
		} else if (/^\d*$/.test(value) == false) {
			// must be a non negative integer
			return /^\d*$/.test(value);
		} else {
			return true;
		}
	});
</script>
