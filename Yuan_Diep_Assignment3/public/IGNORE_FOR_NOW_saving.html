// Compute subtotal
	var subtotal = 0;

	// Compute tax
	var tax_rate = 0.0475;
	var tax = tax_rate * subtotal;

	if (typeof request.session.cart != "undefined") {
		quantities = request.session.cart["iPhone"];
		products = products_data["iPhone"];
		for (let i in quantities) {
			if (quantities[i] == 0) {
				// if quantities = 0, then skip the row
				continue;
			} else {
				let extended_price = quantities[i] * products[i].price;
				console.log(products[i].price);
				// toFixed added to $ values to preserve cents
				response.write(`
	<tr>
	  <td align="center"><img src="${
			products[i].image
		}" class="img-responsive" style="width:50%; height:auto;" alt="Image"></td>
	  <td>${products[i].name}</td>
	  <td align="center">${quantities[i]}</td>
	  <td align="center">$${products[i].price.toFixed(2)}</td>
	  <td>$${(quantities[i] * products[i].price).toFixed(2)}</td>
	</tr>
	  `);
			}
			subtotal += extended_price;
			console.log(products[i].price);
		}
	}

	// Compute shipping
	var shipping;
	if (subtotal < 1000) {
		shipping = 5;
	} else if (subtotal >= 1000 && subtotal < 1500) {
		shipping = 10;
	} else if (subtotal >= 1500) {
		shipping = subtotal * 0.02;
	}
	// Compute grand total
	var total = tax + subtotal + shipping;

	response.write(`
		  <!-- table formatting, with some inline css -->
		  <tr>
			<td colspan="5" width="100%">&nbsp;</td>
		  </tr>
		  <tr>
			<td style="text-align: right;" colspan="4" width="67%">Sub-total</td>
			<td width="54%">$
			  ${subtotal.toFixed(2)}
			</td>
		  </tr>
		  <tr>
			<td style="text-align: right;" colspan="4" width="67%">Tax @ 4.75%</span></td>
			<td width="54%">$
			${tax.toFixed(2)}
			</td>
		  </tr>
		  <tr>
			<td style="text-align: right;" colspan="4" width="67%">Shipping</td>
			<td width="54%">$
			${shipping.toFixed(2)}
			</td>
		  </tr>
		  <tr>
			<td style="text-align: right;" colspan="4" width="67%"><strong>Total</strong></td>
			<td width="54%"><strong>$
			${total.toFixed(2)}
			  </strong></td>
		  </tr>
		  <tr>
			<td style="text-align: center;" colspan="5" width="100%">
			  <b> <!-- shipping policy info -->
				Shipping Policy:
				<BR>
				Orders with subtotals of $0 - $999.99 will be charged $5 for shipping.
				<BR>
				Orders with subtotals of $1000 - $1499.99 will be charged $10 for shipping.
				<BR>Orders with subtotals of $1500 and over will be charged 2% of the subtotal amount.</b>
			</td>
		  </tr>
		  <tr>
			<td style="text-align: center;" colspan="5" width="100%">
			  <form name='confirmpurchase' action=/goodbye? method="POST">
			<input type="submit" id="button" value='Confirm Purchase' id="Return" class="button"></input>
		  </form>
		   </td>
		  </tr>
		</tbody>
	  </table>
	</main>
	</body>
	
	</html>`);